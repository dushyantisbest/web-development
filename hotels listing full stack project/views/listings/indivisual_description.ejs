<% layout("/layout/boilerplate.ejs") -%>

<div class="container py-4">
  <div class="row">
    <!-- Main Image Column -->
    <div class="col-lg-8 mb-4">
      <img
        src="<%= hotelData.image %>"
        alt="<%= hotelData.title %>"
        class="img-fluid rounded shadow-sm w-100"
        style="max-height: 500px; object-fit: cover"
      />
    </div>

    <!-- Details Column -->
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <h1 class="h2 mb-3"><%= hotelData.title %></h1>
          <p class="text-muted mb-3">
            <i class="fa-solid fa-location-dot me-2"></i>
            <%= hotelData.location%>, <%= hotelData.country %>
          </p>
          <h3 class="h4 mb-4 text-danger">
            &#x20B9;<%= hotelData.price.toLocaleString("en-IN") %>
            <span class="text-muted fs-6">/night</span>
          </h3>

          <hr class="my-4" />

          <p class="mb-4"><%= hotelData.description %></p>

          <div class="d-flex align-items-center mb-4">
            <i class="fa-solid fa-user-circle fs-4 me-2"></i>
            <p class="mb-0">Hosted by <b><%= hotelData.owner.username %></b></p>
          </div>

          <% if (currUser && currUser.id === hotelData.owner.id) { %>
          <div class="d-grid gap-2">
            <form action="/listing/edit/<%= hotelData._id %>" method="get">
              <button type="submit" class="btn btn-outline-primary w-100 mb-2">
                <i class="fa-solid fa-edit me-2"></i>Edit Listing
              </button>
            </form>

            <form
              method="POST"
              action="/listing/delete/<%= hotelData._id %>?_method=DELETE"
            >
              <button type="submit" class="btn btn-outline-danger w-100">
                <i class="fa-solid fa-trash me-2"></i>Delete Listing
              </button>
            </form>
          </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Reviews Section -->
<div class="container py-5">
  <div class="row">
    <div class="col-12">
      <!-- Reviews List -->
      <h3 class="mb-4">Reviews & Ratings</h3>
      <div
        class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-xl-4 g-4 mb-5"
      >
        <% for(let review of hotelData.reviews ) { %>
        <div class="col">
          <div class="card h-100 border-0 shadow-sm">
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <i class="fa-solid fa-user-circle fs-4 text-secondary me-2"></i>
                <div>
                  <h6 class="mb-0"><%= review.createdBy.username %></h6>
                  <div class="stars star-<%= review.rating %>"></div>
                </div>
              </div>
              <p class="card-text text-muted mb-3"><%= review.comment %></p>

              <% if (currUser && currUser.id === review.createdBy.id) { %>
              <form
                method="post"
                action="/listing/<%= hotelData._id %>/review/<%= review.id %>?_method=DELETE"
                class="mt-3"
              >
                <button type="submit" class="btn btn-outline-danger btn-sm">
                  <i class="fa-solid fa-trash-alt"></i>
                </button>
              </form>
              <% } %>
            </div>
          </div>
        </div>
        <% } %>
      </div>

      <!-- Review Form -->
      <div class="card border-0 shadow-sm p-4">
        <h4 class="mb-4">Write a Review</h4>
        <form
          action="/listing/<%= hotelData._id %>/review"
          method="post"
          class="needs-validation"
          novalidate
        >
          <div class="mb-4">
            <label for="rating" class="form-label fw-bold mb-3">Rating</label>
            <div class="rating-container">
              <fieldset class="starability-slot">
                <input
                  type="radio"
                  id="no-rate"
                  class="input-no-rate"
                  name="rating"
                  value="1"
                  checked
                  aria-label="No rating."
                />
                <input type="radio" id="first-rate1" name="rating" value="1" />
                <label for="first-rate1" title="Terrible">1 star</label>
                <input type="radio" id="first-rate2" name="rating" value="2" />
                <label for="first-rate2" title="Not good">2 stars</label>
                <input type="radio" id="first-rate3" name="rating" value="3" />
                <label for="first-rate3" title="Average">3 stars</label>
                <input type="radio" id="first-rate4" name="rating" value="4" />
                <label for="first-rate4" title="Very good">4 stars</label>
                <input type="radio" id="first-rate5" name="rating" value="5" />
                <label for="first-rate5" title="Amazing">5 stars</label>
              </fieldset>
            </div>
          </div>

          <div class="mb-4">
            <label for="comment" class="form-label fw-bold">Your Review</label>
            <textarea
              name="comment"
              rows="4"
              class="form-control"
              placeholder="Share your experience with this property..."
              required
            ></textarea>
            <div class="invalid-feedback">Please write your review</div>
          </div>

          <button type="submit" class="btn btn-primary review">Submit</button>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
  .stars {
    color: #ffc107;
  }

  .review-card {
    transition: transform 0.2s;
  }

  .review-card:hover {
    transform: translateY(-5px);
  }

  @media (max-width: 768px) {
    .container {
      padding-left: 15px;
      padding-right: 15px;
    }
  }
</style>
